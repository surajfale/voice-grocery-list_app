# RAG Manual Testing Checklist

Use this checklist to validate the Retrieval-Augmented Generation experience end to end after deploying a new version.

## 1. Happy Path Chat
- [ ] Upload at least two receipts (different merchants/dates) and wait for ingestion to finish.
- [ ] Ask “What did I spend on groceries last week?” and confirm an answer renders with markdown formatting.
- [ ] Verify source cards list the expected receipts and clicking a card opens that receipt in the detail panel.
- [ ] Use the copy button to copy an answer and paste it elsewhere to confirm clipboard support.
- [ ] Click “Regenerate” on the most recent answer and ensure a refreshed response appears without duplicating history entries unexpectedly.

## 2. Filters & Context
- [ ] Apply a date range filter (e.g., last 7 days) and confirm results only reference receipts inside that window.
- [ ] Select multiple merchants via the autocomplete and verify that only those receipts are cited.
- [ ] Choose specific receipt IDs and confirm the API request contains the correct `receiptIds` payload (check browser devtools).
- [ ] Use the “Clear filters” button and ensure chips disappear and subsequent answers consider all receipts.

## 3. Loading & Network States
- [ ] Trigger a chat request and confirm the status badge transitions from “Searching receipts…” to “Generating answer…”.
- [ ] Disable your network connection mid-request to ensure the UI shows the offline warning and the error toast suggests reconnection.
- [ ] Re-enable the network and retry using the “Retry last” button; confirm the request resumes successfully.
- [ ] Initiate a long-running query (e.g., extremely broad question) and verify the front end keeps the loading indicator visible until a response arrives or an error displays.

## 4. Error Handling Scenarios
- [ ] Ask a question with fewer than 3 characters and confirm the validation error appears immediately without hitting the API.
- [ ] Trigger an intentional backend failure (e.g., temporarily revoke `OPENAI_API_KEY`) and ensure the UI shows a helpful fallback message with a retry option.
- [ ] Hit the chat endpoint repeatedly (more than 20 times within 15 minutes) to confirm the 429 rate-limit message surfaces in the UI.
- [ ] When no receipts match the filters, confirm the info alert “No receipts matched this query” appears inside the answer card.
- [ ] Attempt to upload the same receipt twice and confirm the UI surfaces the duplicate warning instructing you to delete the existing copy.

## 5. Backend Spot Checks
- [ ] Run `pnpm --filter backend test` and ensure all Vitest suites pass (chunker, RAG service, chat route).
- [ ] Inspect `coverage/index.html` (generated by Vitest) to verify the new tests cover the RAG-related files.
- [ ] Tail backend logs during a chat session to ensure `ReceiptRagService` retrieval/generation logs appear as expected.

## 6. Cross-Browser & Device
- [ ] Test the chat UI in Chrome, Safari, and Firefox to confirm layout consistency (filters, markdown, cards).
- [ ] On a mobile device or emulator, ensure the filters collapse nicely and buttons remain reachable.
- [ ] Verify dark mode still renders readable markdown and source cards.

Document any failures (with reproduction steps and console/network logs) before marking the checklist complete.

## 7. Local Pipeline Harness
- Use `pnpm --filter backend test:receipt-local -- --file ./receipts/sample.jpg --user <ObjectId> --question "What did I spend?"`
  - Requires `MONGODB_URI` + `OPENAI_API_KEY` in the environment (same as backend server).
  - Script uploads the provided file to GridFS, runs OCR, chunking, embeddings, and issues a RAG chat scoped to that receipt.
  - Add `--no-chat` to stop before the LLM call or `--chunk-size <words>` to override chunk length for experiments.
  - Supply multiple `--file` flags (or `--files path1,path2`) to stitch long receipts locally before OCR—the order of the flags controls the vertical stacking.


